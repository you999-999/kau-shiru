# お問い合わせ機能のセットアップ

## 1. データベースマイグレーション

SupabaseのSQL Editorで以下のマイグレーションを実行してください：

```sql
-- supabase/migration_add_contacts_table.sql の内容を実行
```

## 2. メール送信の設定（Resend - 無料プラン：月3000通まで）

### Resendアカウントの作成

1. [Resend](https://resend.com/) にアカウントを作成（無料）
2. ダッシュボードからAPIキーを取得

### 環境変数の設定

`.env.local` に以下を追加：

```env
RESEND_API_KEY=re_xxxxxxxxxxxxx
```

### ドメインの設定（オプション）

- カスタムドメインを使用する場合は、Resendでドメインを設定
- デフォルトでは `noreply@kau-shiru.vercel.app` が送信元として使用されます
- カスタムドメインがなくても、Resendのデフォルトドメインで送信可能

## 3. パッケージのインストール

既にインストール済みです（`nodemailer`は不要になりました）。

## 4. 動作確認

1. お問い合わせフォームから送信
2. Supabaseの `contacts` テーブルにデータが保存されることを確認
3. `ichigoichie.contact.0015@gmail.com` にメールが届くことを確認

## 月3000通を超えた場合の動作

**重要：月3000通を超えても、エラーにはなりません。**

- ✅ お問い合わせは正常にSupabaseに保存されます
- ⚠️ メールは送信されません（静かにスキップされます）
- 📝 サーバーログに警告メッセージが記録されます
- 🔄 翌月になると、再びメール送信が可能になります

**推奨：**
- 月3000通を超える可能性がある場合は、Supabaseダッシュボードで定期的にお問い合わせを確認してください
- または、Resendの有料プランにアップグレード（月$20から）

## 注意事項

- Resend APIキーが設定されていない場合、メール送信はスキップされますが、DB保存は正常に動作します
- メール送信に失敗しても、お問い合わせはDBに保存されます
- メール送信のログはサーバー側のコンソールに出力されます
- 月3000通を超えても、アプリは正常に動作し続けます（メール送信のみスキップ）

## トラブルシューティング

### メールが届かない場合

1. Resend APIキーが正しく設定されているか確認
2. Resendダッシュボードで送信履歴を確認
3. 月間送信上限（3000通）に達していないか確認
4. サーバーログでエラーメッセージを確認

### 認証エラーが出る場合

- APIキーが正しくコピーされているか確認
- ResendダッシュボードでAPIキーが有効か確認
